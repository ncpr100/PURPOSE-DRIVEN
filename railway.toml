# Railway Configuration - FORCE BYPASS METAL BUILDER INFRASTRUCTURE
# CRITICAL: Metal builder "builder-cbuxkt" persistently hanging at "scheduling build"
# EMERGENCY: Force different builder infrastructure to bypass hanging

[build]
# FORCE CLOUD BUILDER - NEVER USE METAL BUILDER
builder = "NIXPACKS"
buildCommand = "./scripts/railway-build-fix.sh"

# FORCE INFRASTRUCTURE BYPASS SETTINGS
[build.environment]
# Force different Railway infrastructure region/builder
RAILWAY_BUILDER_TYPE = "cloud"
RAILWAY_FORCE_REGION = "us-west"
RAILWAY_DISABLE_METAL_BUILDER = "true"
RAILWAY_PREFER_STANDARD_BUILDER = "true"

# Memory and process optimization  
NODE_OPTIONS = "--max-old-space-size=8192 --max-semi-space-size=1024 --no-deprecation"
NIXPACKS_NO_MUSL = "1"
NIXPACKS_NODE_VERSION = "18"
NIXPACKS_BUILD_CMD = "./scripts/railway-build-fix.sh"

# Prevent npm/build hangs
NPM_CONFIG_AUDIT = "false"
NPM_CONFIG_FUND = "false" 
NPM_CONFIG_PROGRESS = "false"
NPM_CONFIG_LOGLEVEL = "error"

# Force fast environment
CI = "true"
NODE_ENV = "production"
NEXT_TELEMETRY_DISABLED = "1"

# AGGRESSIVE RAILWAY BYPASS SETTINGS
RAILWAY_BUILD_PRIORITY = "immediate"
RAILWAY_BUILD_TIMEOUT = "900" 
RAILWAY_FORCE_NEW_INSTANCE = "true"
RAILWAY_SKIP_CACHE = "true"

# Build command with timeout protection
[build.watchPaths]
include = ["app/**", "components/**", "lib/**", "prisma/**", "public/**"]
ignore = ["node_modules/**", ".next/**", ".git/**"]

# Deployment settings
[deploy]
healthcheckPath = "/api/health"
healthcheckTimeout = 30
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

# Service configuration to prevent hangs
[service]
# Force restart if build hangs for too long
startCommand = "npm run start"