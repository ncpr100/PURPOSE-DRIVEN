#!/bin/bash

# NOTIFICATIONS MODULE - Comprehensive Validation Report
# Executes all priority levels and generates detailed report

echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë  NOTIFICATIONS MODULE - COMPREHENSIVE VALIDATION REPORT        ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""
echo "üìÖ Date: $(date '+%Y-%m-%d %H:%M:%S')"
echo "üè¢ Module: Notifications"
echo "üéØ Validation: P0 + P1 + P2 Complete Test Suite"
echo ""

# Create temporary results directory
RESULTS_DIR="/tmp/notification-test-results-$(date +%s)"
mkdir -p "$RESULTS_DIR"

# Initialize tracking
OVERALL_STATUS="PASS"
P0_STATUS="UNKNOWN"
P1_STATUS="UNKNOWN"
P2_STATUS="UNKNOWN"

echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üöÄ PHASE 1: P0 CRITICAL INFRASTRUCTURE VALIDATION"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

if [ -f "./tests/notifications-validation-p0.sh" ]; then
    ./tests/notifications-validation-p0.sh > "$RESULTS_DIR/p0-results.txt" 2>&1
    P0_EXIT_CODE=$?
    
    if [ $P0_EXIT_CODE -eq 0 ]; then
        P0_STATUS="‚úÖ PASS"
        echo "‚úÖ P0 Critical Tests: PASSED"
    else
        P0_STATUS="‚ùå FAIL"
        OVERALL_STATUS="FAIL"
        echo "‚ùå P0 Critical Tests: FAILED"
        echo "‚ö†Ô∏è  CRITICAL: P0 failures must be addressed immediately!"
    fi
else
    P0_STATUS="‚ö†Ô∏è  SKIP (script not found)"
    echo "‚ö†Ô∏è  P0 test script not found"
fi

echo ""
cat "$RESULTS_DIR/p0-results.txt" | tail -20
echo ""

echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üé® PHASE 2: P1 HIGH PRIORITY FEATURE VALIDATION"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

if [ -f "./tests/notifications-validation-p1.sh" ]; then
    ./tests/notifications-validation-p1.sh > "$RESULTS_DIR/p1-results.txt" 2>&1
    P1_EXIT_CODE=$?
    
    if [ $P1_EXIT_CODE -eq 0 ]; then
        P1_STATUS="‚úÖ PASS"
        echo "‚úÖ P1 Feature Tests: PASSED"
    else
        P1_STATUS="‚ö†Ô∏è  FAIL"
        echo "‚ö†Ô∏è  P1 Feature Tests: FAILED (but may be within threshold)"
    fi
else
    P1_STATUS="‚ö†Ô∏è  SKIP (script not found)"
    echo "‚ö†Ô∏è  P1 test script not found"
fi

echo ""
cat "$RESULTS_DIR/p1-results.txt" | tail -20
echo ""

echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "‚ö° PHASE 3: P2 ADVANCED FEATURE VALIDATION"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

if [ -f "./tests/notifications-validation-p2.sh" ]; then
    ./tests/notifications-validation-p2.sh > "$RESULTS_DIR/p2-results.txt" 2>&1
    P2_EXIT_CODE=$?
    
    if [ $P2_EXIT_CODE -eq 0 ]; then
        P2_STATUS="‚úÖ PASS"
        echo "‚úÖ P2 Advanced Tests: PASSED"
    else
        P2_STATUS="üí° PARTIAL"
        echo "üí° P2 Advanced Tests: PARTIAL (optimization opportunities)"
    fi
else
    P2_STATUS="‚ö†Ô∏è  SKIP (script not found)"
    echo "‚ö†Ô∏è  P2 test script not found"
fi

echo ""
cat "$RESULTS_DIR/p2-results.txt" | tail -20
echo ""

echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üîç PHASE 4: DATABASE VALIDATION"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

if [ -f "./tests/notifications-database-validator.js" ]; then
    echo "Running database validation..."
    node ./tests/notifications-database-validator.js > "$RESULTS_DIR/db-validation.txt" 2>&1
    DB_EXIT_CODE=$?
    
    if [ $DB_EXIT_CODE -eq 0 ]; then
        echo "‚úÖ Database Validation: PASSED"
    else
        echo "‚ùå Database Validation: FAILED"
        OVERALL_STATUS="FAIL"
    fi
    
    echo ""
    cat "$RESULTS_DIR/db-validation.txt"
else
    echo "‚ö†Ô∏è  Database validator not found"
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üìä COMPREHENSIVE VALIDATION SUMMARY"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""
echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê"
echo "‚îÇ Test Level        ‚îÇ Status                                 ‚îÇ"
echo "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§"
echo "‚îÇ P0 Critical       ‚îÇ $P0_STATUS"
echo "‚îÇ P1 High Priority  ‚îÇ $P1_STATUS"
echo "‚îÇ P2 Advanced       ‚îÇ $P2_STATUS"
echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"
echo ""

# Extract test counts from results
if [ -f "$RESULTS_DIR/p0-results.txt" ]; then
    P0_TOTAL=$(grep "Total Tests:" "$RESULTS_DIR/p0-results.txt" | awk '{print $3}')
    P0_PASSED=$(grep "Passed:" "$RESULTS_DIR/p0-results.txt" | awk '{print $2}')
    P0_FAILED=$(grep "Failed:" "$RESULTS_DIR/p0-results.txt" | awk '{print $2}')
fi

if [ -f "$RESULTS_DIR/p1-results.txt" ]; then
    P1_TOTAL=$(grep "Total Tests:" "$RESULTS_DIR/p1-results.txt" | awk '{print $3}')
    P1_PASSED=$(grep "Passed:" "$RESULTS_DIR/p1-results.txt" | awk '{print $2}')
    P1_FAILED=$(grep "Failed:" "$RESULTS_DIR/p1-results.txt" | awk '{print $2}')
fi

if [ -f "$RESULTS_DIR/p2-results.txt" ]; then
    P2_TOTAL=$(grep "Total Tests:" "$RESULTS_DIR/p2-results.txt" | awk '{print $3}')
    P2_PASSED=$(grep "Passed:" "$RESULTS_DIR/p2-results.txt" | awk '{print $2}')
    P2_FAILED=$(grep "Failed:" "$RESULTS_DIR/p2-results.txt" | awk '{print $2}')
fi

echo "üìà Detailed Results:"
echo "  P0: $P0_PASSED/$P0_TOTAL passed"
echo "  P1: $P1_PASSED/$P1_TOTAL passed"
echo "  P2: $P2_PASSED/$P2_TOTAL passed"
echo ""

# Calculate overall totals
TOTAL_TESTS=$((P0_TOTAL + P1_TOTAL + P2_TOTAL))
TOTAL_PASSED=$((P0_PASSED + P1_PASSED + P2_PASSED))
TOTAL_FAILED=$((P0_FAILED + P1_FAILED + P2_FAILED))

if [ $TOTAL_TESTS -gt 0 ]; then
    OVERALL_RATE=$(awk "BEGIN {printf \"%.1f\", ($TOTAL_PASSED/$TOTAL_TESTS)*100}")
    echo "üéØ Overall Success Rate: $OVERALL_RATE% ($TOTAL_PASSED/$TOTAL_TESTS tests)"
else
    echo "‚ö†Ô∏è  No tests were executed"
    OVERALL_RATE=0
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üéØ RECOMMENDATIONS"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""

if [ "$OVERALL_STATUS" = "FAIL" ]; then
    echo "‚ùå CRITICAL ISSUES DETECTED"
    echo "   Action Required: Fix P0 failures immediately"
    echo "   Status: NOT READY FOR PRODUCTION"
    echo ""
    echo "   Failed Tests:"
    if [ $P0_FAILED -gt 0 ]; then
        echo "   - P0 Critical: $P0_FAILED failures"
    fi
    if [ $P1_FAILED -gt 0 ]; then
        echo "   - P1 Features: $P1_FAILED failures"
    fi
    if [ $P2_FAILED -gt 0 ]; then
        echo "   - P2 Advanced: $P2_FAILED failures"
    fi
elif [ $(awk "BEGIN {print ($OVERALL_RATE >= 95)}") -eq 1 ]; then
    echo "‚úÖ EXCELLENT - PRODUCTION READY"
    echo "   The notifications module is in excellent condition"
    echo "   Status: READY FOR IMMEDIATE DEPLOYMENT"
    echo ""
    echo "   Next Steps:"
    echo "   1. Deploy to production with confidence"
    echo "   2. Monitor notification delivery metrics"
    echo "   3. Continue with remaining module validations"
elif [ $(awk "BEGIN {print ($OVERALL_RATE >= 85)}") -eq 1 ]; then
    echo "‚úÖ GOOD - READY WITH MINOR IMPROVEMENTS"
    echo "   The notifications module is functional"
    echo "   Status: PRODUCTION READY (with monitoring)"
    echo ""
    echo "   Recommendations:"
    echo "   1. Address P1/P2 failures when possible"
    echo "   2. Monitor for any issues in production"
    echo "   3. Schedule optimization work"
else
    echo "‚ö†Ô∏è  NEEDS IMPROVEMENT"
    echo "   Several tests are failing"
    echo "   Status: REQUIRES ATTENTION BEFORE PRODUCTION"
    echo ""
    echo "   Action Plan:"
    echo "   1. Review and fix failing tests"
    echo "   2. Re-run validation after fixes"
    echo "   3. Consider postponing deployment"
fi

echo ""
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo "üìÅ DETAILED RESULTS SAVED TO:"
echo "    $RESULTS_DIR"
echo "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"
echo ""
echo "Files:"
echo "  - p0-results.txt (Critical Infrastructure)"
echo "  - p1-results.txt (High Priority Features)"
echo "  - p2-results.txt (Advanced Features)"
echo "  - db-validation.txt (Database Validation)"
echo ""

# Save summary report
SUMMARY_FILE="$RESULTS_DIR/summary-report.txt"
cat > "$SUMMARY_FILE" << EOF
NOTIFICATIONS MODULE - VALIDATION SUMMARY REPORT
================================================

Date: $(date '+%Y-%m-%d %H:%M:%S')
Module: Notifications
Overall Status: $OVERALL_STATUS

Test Results:
-------------
P0 Critical:      $P0_STATUS ($P0_PASSED/$P0_TOTAL passed)
P1 High Priority: $P1_STATUS ($P1_PASSED/$P1_TOTAL passed)
P2 Advanced:      $P2_STATUS ($P2_PASSED/$P2_TOTAL passed)

Overall:          $TOTAL_PASSED/$TOTAL_TESTS passed ($OVERALL_RATE%)

Production Readiness:
--------------------
$(if [ "$OVERALL_STATUS" = "FAIL" ]; then
    echo "NOT READY - Critical issues must be resolved"
elif [ $(awk "BEGIN {print ($OVERALL_RATE >= 95)}") -eq 1 ]; then
    echo "READY - Excellent condition for immediate deployment"
elif [ $(awk "BEGIN {print ($OVERALL_RATE >= 85)}") -eq 1 ]; then
    echo "READY - Good condition with monitoring recommended"
else
    echo "NOT READY - Requires attention before production"
fi)

EOF

echo "üìÑ Summary report saved to: $SUMMARY_FILE"
echo ""

# Exit with appropriate code
if [ "$OVERALL_STATUS" = "FAIL" ]; then
    exit 1
else
    exit 0
fi
