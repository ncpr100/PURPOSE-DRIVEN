

import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function seedSubscriptionData() {
  console.log('üéØ Seeding subscription data...')

  try {
    // Create Plan Features
    console.log('üìã Creating plan features...')
    
    const features = await Promise.all([
      // Core Features (B√ÅSICO)
      prisma.planFeature.upsert({
        where: { key: 'members_management' },
        update: {},
        create: {
          key: 'members_management',
          name: 'Gesti√≥n de Miembros',
          description: 'Administraci√≥n completa de miembros de la iglesia',
          category: 'core'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'events_management' },
        update: {},
        create: {
          key: 'events_management',
          name: 'Gesti√≥n de Eventos',
          description: 'Creaci√≥n y administraci√≥n de eventos',
          category: 'core'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'donations_basic' },
        update: {},
        create: {
          key: 'donations_basic',
          name: 'Donaciones B√°sicas',
          description: 'Sistema b√°sico de registro de donaciones',
          category: 'core'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'basic_reports' },
        update: {},
        create: {
          key: 'basic_reports',
          name: 'Reportes B√°sicos',
          description: 'Reportes simples de miembros y donaciones',
          category: 'core'
        }
      }),

      // Advanced Features (PROFESIONAL)
      prisma.planFeature.upsert({
        where: { key: 'analytics_dashboard' },
        update: {},
        create: {
          key: 'analytics_dashboard',
          name: 'Dashboard de Analytics',
          description: 'Dashboard completo con m√©tricas y gr√°ficos',
          category: 'advanced'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'automation_rules' },
        update: {},
        create: {
          key: 'automation_rules',
          name: 'Automatizaciones',
          description: 'Reglas de automatizaci√≥n y triggers',
          category: 'advanced'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'advanced_reports' },
        update: {},
        create: {
          key: 'advanced_reports',
          name: 'Reportes Avanzados',
          description: 'Reportes personalizados y programables',
          category: 'advanced'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'communications' },
        update: {},
        create: {
          key: 'communications',
          name: 'Sistema de Comunicaciones',
          description: 'Env√≠o masivo de emails y notificaciones',
          category: 'advanced'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'volunteer_management' },
        update: {},
        create: {
          key: 'volunteer_management',
          name: 'Gesti√≥n de Voluntarios',
          description: 'Administraci√≥n completa de voluntarios',
          category: 'advanced'
        }
      }),

      // Enterprise Features
      prisma.planFeature.upsert({
        where: { key: 'api_access' },
        update: {},
        create: {
          key: 'api_access',
          name: 'Acceso a API',
          description: 'API completa para integraciones personalizadas',
          category: 'enterprise'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'multi_church' },
        update: {},
        create: {
          key: 'multi_church',
          name: 'Multi-Iglesia',
          description: 'Gesti√≥n de m√∫ltiples iglesias desde una cuenta',
          category: 'enterprise'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'custom_branding' },
        update: {},
        create: {
          key: 'custom_branding',
          name: 'Marca Personalizada',
          description: 'Personalizaci√≥n completa de marca y colores',
          category: 'enterprise'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'priority_support' },
        update: {},
        create: {
          key: 'priority_support',
          name: 'Soporte Prioritario',
          description: 'Soporte 24/7 con respuesta prioritaria',
          category: 'enterprise'
        }
      }),
      prisma.planFeature.upsert({
        where: { key: 'advanced_integrations' },
        update: {},
        create: {
          key: 'advanced_integrations',
          name: 'Integraciones Avanzadas',
          description: 'Integraciones con sistemas externos',
          category: 'enterprise'
        }
      })
    ])

    console.log(`‚úÖ Created ${features.length} plan features`)

    // Create Subscription Plans
    console.log('üí≥ Creating subscription plans...')

    const basicFeatures = [
      'members_management',
      'events_management', 
      'donations_basic',
      'basic_reports'
    ]

    const professionalFeatures = [
      ...basicFeatures,
      'analytics_dashboard',
      'automation_rules',
      'advanced_reports',
      'communications',
      'volunteer_management'
    ]

    const enterpriseFeatures = [
      ...professionalFeatures,
      'api_access',
      'multi_church',
      'custom_branding',
      'priority_support',
      'advanced_integrations'
    ]

    const plans = await Promise.all([
      // B√ÅSICO Plan - CORRECTED PRICING
      prisma.subscriptionPlan.upsert({
        where: { name: 'B√ÅSICO' },
        update: {
          priceMonthly: '25,000', // Direct string input
          priceYearly: '270,000', // Direct string input
          features: basicFeatures
        },
        create: {
          name: 'B√ÅSICO',
          displayName: 'Plan B√°sico',
          description: 'Perfecto para iglesias peque√±as que necesitan funcionalidades esenciales',
          priceMonthly: '25,000', // Direct string input
          priceYearly: '270,000', // Direct string input
          maxChurches: 1,
          maxMembers: 100,
          maxUsers: 3,
          features: basicFeatures,
          sortOrder: 1
        }
      }),

      // PROFESIONAL Plan - CORRECTED PRICING
      prisma.subscriptionPlan.upsert({
        where: { name: 'PROFESIONAL' },
        update: {
          priceMonthly: '75,000', // Direct string input
          priceYearly: '810,000', // Direct string input
          features: professionalFeatures
        },
        create: {
          name: 'PROFESIONAL',
          displayName: 'Plan Profesional',
          description: 'Para iglesias medianas con necesidades avanzadas de gesti√≥n y analytics',
          priceMonthly: '75,000', // Direct string input
          priceYearly: '810,000', // Direct string input
          maxChurches: 1,
          maxMembers: 500,
          maxUsers: 10,
          features: professionalFeatures,
          sortOrder: 2
        }
      }),

      // ENTERPRISE Plan - CORRECTED PRICING
      prisma.subscriptionPlan.upsert({
        where: { name: 'ENTERPRISE' },
        update: {
          priceMonthly: '150,000', // Direct string input
          priceYearly: '1620,000', // Direct string input
          features: enterpriseFeatures
        },
        create: {
          name: 'ENTERPRISE',
          displayName: 'Plan Enterprise',
          description: 'Para organizaciones grandes con m√∫ltiples iglesias y necesidades personalizadas',
          priceMonthly: '150,000', // Direct string input
          priceYearly: '1620,000', // Direct string input
          maxChurches: 999,
          maxMembers: 99999,
          maxUsers: 50,
          features: enterpriseFeatures,
          sortOrder: 3
        }
      })
    ])

    console.log(`‚úÖ Created ${plans.length} subscription plans`)

    // Create Subscription Add-ons
    console.log('üîß Creating subscription add-ons...')

    const addons = await Promise.all([
      // SMS Notifications
      prisma.subscriptionAddon.upsert({
        where: { key: 'sms_notifications' },
        update: {},
        create: {
          key: 'sms_notifications',
          name: 'Notificaciones SMS',
          description: 'Env√≠o de notificaciones por SMS a miembros',
          priceMonthly: '0', // Direct string input
          billingType: 'PER_USE',
          pricePerUnit: '50', // Direct string input
          unit: 'SMS'
        }
      }),

      // WhatsApp Integration
      prisma.subscriptionAddon.upsert({
        where: { key: 'whatsapp_integration' },
        update: {},
        create: {
          key: 'whatsapp_integration',
          name: 'Integraci√≥n WhatsApp',
          description: 'Integraci√≥n completa con WhatsApp Business API',
          priceMonthly: '50,000', // Direct string input
          priceYearly: '540,000', // Direct string input
          billingType: 'MONTHLY'
        }
      }),

      // Custom Branding
      prisma.subscriptionAddon.upsert({
        where: { key: 'custom_branding' },
        update: {},
        create: {
          key: 'custom_branding',
          name: 'Marca Personalizada',
          description: 'Personalizaci√≥n completa de colores, logo y marca',
          priceMonthly: '30,000', // Direct string input
          priceYearly: '324,000', // Direct string input
          billingType: 'MONTHLY'
        }
      }),

      // Advanced Analytics
      prisma.subscriptionAddon.upsert({
        where: { key: 'advanced_analytics' },
        update: {},
        create: {
          key: 'advanced_analytics',
          name: 'Analytics Avanzados',
          description: 'Dashboards personalizados y m√©tricas detalladas',
          priceMonthly: '40,000', // Direct string input
          priceYearly: '432,000', // Direct string input
          billingType: 'MONTHLY'
        }
      }),

      // Priority Support
      prisma.subscriptionAddon.upsert({
        where: { key: 'priority_support' },
        update: {},
        create: {
          key: 'priority_support',
          name: 'Soporte Prioritario',
          description: 'Soporte 24/7 con respuesta en menos de 2 horas',
          priceMonthly: '60,000', // Direct string input
          priceYearly: '648,000', // Direct string input
          billingType: 'MONTHLY'
        }
      })
    ])

    console.log(`‚úÖ Created ${addons.length} subscription add-ons`)

    console.log('‚úÖ Subscription data seeded successfully!')
    console.log('')
    console.log('üìä PRICING SUMMARY (CORRECTED):')
    console.log('‚îú‚îÄ‚îÄ B√ÅSICO: $25.00 USD/mes ($270.00 USD/a√±o)')
    console.log('‚îú‚îÄ‚îÄ PROFESIONAL: $75.00 USD/mes ($810.00 USD/a√±o)')
    console.log('‚îî‚îÄ‚îÄ ENTERPRISE: $150.00 USD/mes ($1,620.00 USD/a√±o)')
    console.log('')
    console.log('üîß ADD-ONS AVAILABLE:')
    console.log('‚îú‚îÄ‚îÄ SMS Notifications: $0.50 COP por SMS')
    console.log('‚îú‚îÄ‚îÄ WhatsApp Integration: $50,000 COP/mes')
    console.log('‚îú‚îÄ‚îÄ Custom Branding: $30,000 COP/mes')
    console.log('‚îú‚îÄ‚îÄ Advanced Analytics: $40,000 COP/mes')
    console.log('‚îî‚îÄ‚îÄ Priority Support: $60,000 COP/mes')

  } catch (error) {
    console.error('‚ùå Error seeding subscription data:', error)
    throw error
  } finally {
    await prisma.$disconnect()
  }
}

if (require.main === module) {
  seedSubscriptionData()
    .catch((error) => {
      console.error(error)
      process.exit(1)
    })
}

export default seedSubscriptionData

