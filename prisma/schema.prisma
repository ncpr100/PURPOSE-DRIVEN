generator client {
  provider      = "prisma-client-js"
  output        = "../node_modules/.prisma/client"
  binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model accounts {
  id                String  @id
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  users             users   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model ai_model_ab_tests {
  id                    String                  @id
  testName              String
  churchId              String
  controlModel          String
  testModel             String
  trafficSplit          Float                   @default(0.5)
  startDate             DateTime                @default(now())
  endDate               DateTime?
  isActive              Boolean                 @default(true)
  churches              churches                @relation(fields: [churchId], references: [id], onDelete: Cascade)
  ai_prediction_records ai_prediction_records[]

  @@index([churchId, isActive])
  @@index([startDate, endDate])
}

model ai_model_performance {
  id           String   @id
  churchId     String
  modelVersion String
  metricType   String
  value        Float
  sampleSize   Int
  timeframe    String
  calculatedAt DateTime @default(now())
  churches     churches @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@index([churchId, modelVersion])
  @@index([metricType, calculatedAt])
}

model ai_prediction_records {
  id                  String             @id
  predictionType      String
  memberId            String?
  churchId            String
  predictedValue      Json
  actualValue         Json?
  confidence          Int
  accuracy            Float?
  contributingFactors Json
  modelVersion        String
  predictionDate      DateTime           @default(now())
  validationDate      DateTime?
  abTestId            String?
  ai_model_ab_tests   ai_model_ab_tests? @relation(fields: [abTestId], references: [id])
  churches            churches           @relation(fields: [churchId], references: [id], onDelete: Cascade)
  members             members?           @relation(fields: [memberId], references: [id], onDelete: Cascade)

  @@index([accuracy])
  @@index([churchId, predictionType])
  @@index([predictionDate])
  @@index([validationDate])
}

model analytics_cache {
  id         String   @id
  cacheKey   String
  dataType   String
  data       String
  parameters String?
  expiresAt  DateTime
  churchId   String
  createdAt  DateTime @default(now())
  churches   churches @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@unique([cacheKey, churchId])
}

model analytics_dashboards {
  id                String              @id
  name              String
  description       String?
  layout            String
  isDefault         Boolean             @default(false)
  isPublic          Boolean             @default(false)
  userRole          String?
  createdBy         String
  churchId          String
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now())
  churches          churches            @relation(fields: [churchId], references: [id], onDelete: Cascade)
  dashboard_widgets dashboard_widgets[]
}

model automation_actions {
  id               String               @id
  ruleId           String
  type             AutomationActionType
  configuration    Json                 @default("{}")
  orderIndex       Int                  @default(0)
  delay            Int                  @default(0)
  isActive         Boolean              @default(true)
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @default(now())
  automation_rules automation_rules     @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([orderIndex])
  @@index([ruleId])
  @@index([type])
}

model automation_conditions {
  id               String                  @id
  ruleId           String
  type             AutomationConditionType
  field            String
  operator         String
  value            Json
  logicalOperator  String                  @default("AND")
  groupId          String?
  orderIndex       Int                     @default(0)
  isActive         Boolean                 @default(true)
  createdAt        DateTime                @default(now())
  updatedAt        DateTime                @default(now())
  automation_rules automation_rules        @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([groupId])
  @@index([ruleId])
  @@index([type])
}

model automation_executions {
  id           String      @id
  automationId String
  triggerData  String?
  status       String      @default("EJECUTANDO")
  results      String?
  executedAt   DateTime    @default(now())
  completedAt  DateTime?
  churchId     String
  automations  automations @relation(fields: [automationId], references: [id], onDelete: Cascade)
  churches     churches    @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model automation_rule_executions {
  id               String           @id
  ruleId           String
  triggerData      Json
  status           String           @default("PENDING")
  result           Json?
  error            String?
  executedAt       DateTime?
  duration         Int?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @default(now())
  automation_rules automation_rules @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([ruleId])
  @@index([status])
}

model automation_rule_template_installations {
  id                        String                    @id
  templateId                String
  churchId                  String
  automationRuleId          String?
  isActive                  Boolean                   @default(true)
  customizations            Json?
  installedBy               String
  installedAt               DateTime                  @default(now())
  lastModifiedAt            DateTime                  @default(now())
  automation_rules          automation_rules?         @relation(fields: [automationRuleId], references: [id])
  users                     users                     @relation(fields: [installedBy], references: [id])
  automation_rule_templates automation_rule_templates @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@unique([templateId, churchId])
  @@index([churchId])
  @@index([isActive])
}

model automation_rule_templates {
  id                                     String                                   @id
  name                                   String
  description                            String
  category                               String
  subcategory                            String?
  icon                                   String?
  color                                  String?
  isSystemTemplate                       Boolean                                  @default(false)
  isActive                               Boolean                                  @default(true)
  isPublic                               Boolean                                  @default(true)
  createdBy                              String?
  triggerConfig                          Json
  conditionsConfig                       Json
  actionsConfig                          Json
  priorityLevel                          String                                   @default("NORMAL")
  escalationConfig                       Json?
  businessHoursOnly                      Boolean                                  @default(false)
  businessHoursConfig                    Json?
  urgentMode24x7                         Boolean                                  @default(false)
  retryConfig                            Json?
  fallbackChannels                       Json?
  createManualTaskOnFail                 Boolean                                  @default(true)
  installCount                           Int                                      @default(0)
  lastUsedAt                             DateTime?
  tags                                   String[]
  createdAt                              DateTime                                 @default(now())
  updatedAt                              DateTime                                 @default(now())
  automation_rule_template_installations automation_rule_template_installations[]
  users                                  users?                                   @relation(fields: [createdBy], references: [id])

  @@index([category])
  @@index([isActive])
  @@index([isPublic])
}

model automation_rules {
  id                                     String                                   @id
  name                                   String
  description                            String?
  churchId                               String
  createdBy                              String
  isActive                               Boolean                                  @default(true)
  priority                               Int                                      @default(0)
  executeOnce                            Boolean                                  @default(false)
  maxExecutions                          Int?
  executionCount                         Int                                      @default(0)
  lastExecuted                           DateTime?
  metadata                               Json?
  priorityLevel                          String                                   @default("NORMAL")
  escalationConfig                       Json?
  businessHoursOnly                      Boolean                                  @default(false)
  businessHoursConfig                    Json?
  urgentMode24x7                         Boolean                                  @default(false)
  retryConfig                            Json?
  fallbackChannels                       Json?
  createManualTaskOnFail                 Boolean                                  @default(true)
  bypassApproval                         Boolean                                  @default(false)
  createdAt                              DateTime                                 @default(now())
  updatedAt                              DateTime                                 @default(now())
  automation_actions                     automation_actions[]
  automation_conditions                  automation_conditions[]
  automation_rule_executions             automation_rule_executions[]
  automation_rule_template_installations automation_rule_template_installations[]
  churches                               churches                                 @relation(fields: [churchId], references: [id], onDelete: Cascade)
  users                                  users                                    @relation(fields: [createdBy], references: [id])
  automation_triggers                    automation_triggers[]

  @@index([bypassApproval])
  @@index([churchId])
  @@index([isActive])
  @@index([priorityLevel])
  @@index([priority])
}

model automation_templates {
  id          String   @id
  name        String
  description String?
  category    String
  template    Json
  isSystem    Boolean  @default(false)
  isActive    Boolean  @default(true)
  usageCount  Int      @default(0)
  createdBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users?   @relation(fields: [createdBy], references: [id])

  @@index([category])
  @@index([isActive])
}

model automation_triggers {
  id               String                @id
  ruleId           String
  type             AutomationTriggerType
  eventSource      String?
  configuration    Json                  @default("{}")
  isActive         Boolean               @default(true)
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @default(now())
  automation_rules automation_rules      @relation(fields: [ruleId], references: [id], onDelete: Cascade)

  @@index([isActive])
  @@index([ruleId])
  @@index([type])
}

model automations {
  id                    String                  @id
  name                  String
  description           String?
  trigger               String
  actions               String
  conditions            String?
  isActive              Boolean                 @default(true)
  churchId              String
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @default(now())
  automation_executions automation_executions[]
  churches              churches                @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model availability_matrices {
  id                     String   @id
  memberId               String   @unique
  recurringAvailability  Json
  blackoutDates          Json
  preferredMinistries    Json
  maxCommitmentsPerMonth Int      @default(4)
  preferredTimeSlots     Json
  travelWillingness      Int      @default(1)
  lastUpdated            DateTime @default(now())
  createdAt              DateTime @default(now())
  updatedAt              DateTime @default(now())
  members                members  @relation(fields: [memberId], references: [id], onDelete: Cascade)
}

model check_ins {
  id                  String               @id
  firstName           String
  lastName            String
  email               String?
  phone               String?
  isFirstTime         Boolean              @default(false)
  visitReason         String?
  prayerRequest       String?
  qrCode              String?              @unique
  eventId             String?
  churchId            String
  checkedInAt         DateTime             @default(now())
  createdAt           DateTime             @default(now())
  visitorType         String?
  ministryInterest    String[]             @default([])
  ageGroup            String?
  familyStatus        String?
  referredBy          String?
  followUpFormId      String?
  automationTriggered Boolean              @default(false)
  lastContactDate     DateTime?
  engagementScore     Int                  @default(0)
  churches            churches             @relation(fields: [churchId], references: [id], onDelete: Cascade)
  events              events?              @relation(fields: [eventId], references: [id])
  visitor_follow_ups  visitor_follow_ups[]

  @@index([checkedInAt])
  @@index([churchId, checkedInAt, eventId])
  @@index([churchId, email, checkedInAt])
  @@index([churchId, firstName, lastName, checkedInAt])
  @@index([isFirstTime, churchId, checkedInAt])
}

model children_check_ins {
  id               String    @id
  childName        String
  childAge         Int?
  parentName       String
  parentPhone      String
  parentEmail      String?
  emergencyContact String?
  emergencyPhone   String?
  allergies        String?
  specialNeeds     String?
  qrCode           String    @unique
  checkedIn        Boolean   @default(true)
  checkedInAt      DateTime  @default(now())
  checkedOut       Boolean   @default(false)
  checkedOutAt     DateTime?
  checkedOutBy     String?
  eventId          String?
  churchId         String
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @default(now())
  childPhotoUrl    String?
  parentPhotoUrl   String?
  securityPin      String    @default("000000")
  biometricHash    String?
  photoTakenAt     DateTime?
  backupAuthCodes  String[]  @default([])
  pickupAttempts   Json[]    @default([])
  requiresBothAuth Boolean   @default(true)
  churches         churches  @relation(fields: [churchId], references: [id], onDelete: Cascade)
  events           events?   @relation(fields: [eventId], references: [id])

  @@index([parentPhone])
}

model church_qualification_settings {
  id                                  String   @id
  churchId                            String   @unique
  volunteerMinMembershipDays          Int      @default(0)
  volunteerRequireActiveStatus        Boolean  @default(true)
  volunteerRequireSpiritualAssessment Boolean  @default(false)
  volunteerMinSpiritualScore          Int      @default(0)
  leadershipMinMembershipDays         Int      @default(365)
  leadershipRequireVolunteerExp       Boolean  @default(false)
  leadershipMinVolunteerDays          Int      @default(0)
  leadershipRequireTraining           Boolean  @default(false)
  leadershipMinSpiritualScore         Int      @default(70)
  leadershipMinLeadershipScore        Int      @default(60)
  enableSpiritualMaturityScoring      Boolean  @default(true)
  enableLeadershipAptitudeScoring     Boolean  @default(true)
  enableMinistryPassionMatching       Boolean  @default(true)
  spiritualGiftsWeight                Float    @default(0.4)
  availabilityWeight                  Float    @default(0.25)
  experienceWeight                    Float    @default(0.15)
  ministryPassionWeight               Float    @default(0.1)
  activityWeight                      Float    @default(0.1)
  createdAt                           DateTime @default(now())
  updatedAt                           DateTime
  churches                            churches @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model church_subscription_addons {
  id                   String               @id
  subscriptionId       String
  addonId              String
  quantity             Int                  @default(1)
  isActive             Boolean              @default(true)
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @default(now())
  subscription_addons  subscription_addons  @relation(fields: [addonId], references: [id])
  church_subscriptions church_subscriptions @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@unique([subscriptionId, addonId])
}

model church_subscriptions {
  id                         String                       @id
  churchId                   String                       @unique
  planId                     String
  billingCycle               String                       @default("MONTHLY")
  status                     String                       @default("ACTIVE")
  currentPeriodStart         DateTime
  currentPeriodEnd           DateTime
  trialEnd                   DateTime?
  cancelAtPeriodEnd          Boolean                      @default(false)
  cancelledAt                DateTime?
  metadata                   Json?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @default(now())
  church_subscription_addons church_subscription_addons[]
  churches                   churches                     @relation(fields: [churchId], references: [id], onDelete: Cascade)
  subscription_plans         subscription_plans           @relation(fields: [planId], references: [id])
  invoices                   invoices[]

  @@index([churchId])
  @@index([planId])
  @@index([status])
}

model church_themes {
  id                 String   @id
  churchId           String   @unique
  themeName          String   @default("church-default")
  themeConfig        String
  logoUrl            String?
  faviconUrl         String?
  bannerUrl          String?
  brandColors        String?
  primaryFont        String?  @default("Inter")
  headingFont        String?  @default("Inter")
  layoutStyle        String?  @default("default")
  allowMemberThemes  Boolean  @default(true)
  allowColorChanges  Boolean  @default(true)
  allowFontChanges   Boolean  @default(true)
  allowLayoutChanges Boolean  @default(false)
  isActive           Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime
  churches           churches @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model churches {
  id                               String                             @id
  name                             String
  address                          String?
  phone                            String?
  email                            String?
  website                          String?
  founded                          DateTime?
  logo                             String?
  description                      String?
  isActive                         Boolean                            @default(true)
  createdAt                        DateTime                           @default(now())
  updatedAt                        DateTime
  ai_model_ab_tests                ai_model_ab_tests[]
  ai_model_performance             ai_model_performance[]
  ai_prediction_records            ai_prediction_records[]
  analytics_cache                  analytics_cache[]
  analytics_dashboards             analytics_dashboards[]
  automation_executions            automation_executions[]
  automation_rules                 automation_rules[]
  automations                      automations[]
  check_ins                        check_ins[]
  children_check_ins               children_check_ins[]
  church_qualification_settings    church_qualification_settings?
  church_subscriptions             church_subscriptions?
  church_themes                    church_themes?
  communication_templates          communication_templates[]
  communications                   communications[]
  custom_form_submissions          custom_form_submissions[]
  custom_forms                     custom_forms[]
  custom_reports                   custom_reports[]
  dashboard_widgets                dashboard_widgets[]
  donation_campaigns               donation_campaigns[]
  donation_categories              donation_categories[]
  donations                        donations[]
  event_resource_reservations      event_resource_reservations[]
  event_resources                  event_resources[]
  events                           events[]
  integration_configs              integration_configs[]
  invoices                         invoices[]
  kpi_metrics                      kpi_metrics[]
  marketing_campaign_posts         marketing_campaign_posts[]
  marketing_campaigns              marketing_campaigns[]
  member_behavioral_patterns       member_behavioral_patterns[]
  member_journeys                  member_journeys[]
  members                          members[]
  ministries                       ministries[]
  ministry_gap_analyses            ministry_gap_analyses[]
  ministry_pathway_recommendations ministry_pathway_recommendations[]
  notification_templates           notification_templates[]
  notifications                    notifications[]
  online_payments                  online_payments[]
  payment_gateway_configs          payment_gateway_configs[]
  payment_methods                  payment_methods[]
  prayer_approvals                 prayer_approvals[]
  prayer_categories                prayer_categories[]
  prayer_contacts                  prayer_contacts[]
  prayer_forms                     prayer_forms[]
  prayer_qr_codes                  prayer_qr_codes[]
  prayer_requests                  prayer_requests[]
  prayer_response_templates        prayer_response_templates[]
  prayer_testimonies               prayer_testimonies[]
  push_notification_logs           push_notification_logs[]
  push_subscriptions               push_subscriptions[]
  report_executions                report_executions[]
  report_schedules                 report_schedules[]
  roles                            roles[]
  sermons                          sermons[]
  social_media_accounts            social_media_accounts[]
  social_media_metrics             social_media_metrics[]
  social_media_posts               social_media_posts[]
  tenant_credentials               tenant_credentials?
  testimony_forms                  testimony_forms[]
  testimony_qr_codes               testimony_qr_codes[]
  user_theme_preferences           user_theme_preferences[]
  users                            users[]
  visitor_follow_ups               visitor_follow_ups[]
  visitor_forms                    visitor_forms[]
  visitor_qr_codes                 visitor_qr_codes[]
  visitor_submissions              visitor_submissions[]
  volunteers                       volunteers[]
  website_requests                 website_requests[]
  websites                         websites[]
  qr_codes                         qr_codes[]
}

model communication_templates {
  id             String           @id
  name           String
  subject        String?
  content        String
  type           String
  variables      String?
  category       String?
  isActive       Boolean          @default(true)
  churchId       String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @default(now())
  churches       churches         @relation(fields: [churchId], references: [id], onDelete: Cascade)
  communications communications[]
}

model communications {
  id                      String                   @id
  title                   String
  content                 String
  type                    String
  targetGroup             String?
  recipients              Int?
  status                  String                   @default("BORRADOR")
  scheduledAt             DateTime?
  sentAt                  DateTime?
  sentBy                  String
  templateId              String?
  churchId                String
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @default(now())
  churches                churches                 @relation(fields: [churchId], references: [id], onDelete: Cascade)
  communication_templates communication_templates? @relation(fields: [templateId], references: [id])

  @@index([churchId, createdAt, type])
  @@index([churchId, sentAt, type, status])
  @@index([sentAt, status])
}

model custom_form_submissions {
  id           String       @id
  formId       String
  data         Json
  submittedAt  DateTime     @default(now())
  ipAddress    String?
  userAgent    String?
  churchId     String
  churches     churches     @relation(fields: [churchId], references: [id])
  custom_forms custom_forms @relation(fields: [formId], references: [id], onDelete: Cascade)

  @@index([churchId, submittedAt])
  @@index([formId])
}

model custom_forms {
  id                      String                    @id
  title                   String
  description             String                    @default("")
  fields                  Json
  config                  Json
  qrConfig                Json
  qrCodeUrl               String?
  slug                    String                    @unique
  isActive                Boolean                   @default(true)
  churchId                String
  createdBy               String
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @default(now())
  custom_form_submissions custom_form_submissions[]
  churches                churches                  @relation(fields: [churchId], references: [id], onDelete: Cascade)
  users                   users                     @relation(fields: [createdBy], references: [id])
  qr_codes                qr_codes[]

  @@index([churchId, isActive])
  @@index([slug])
}

model custom_reports {
  id                String              @id
  name              String
  description       String?
  reportType        String
  config            String
  filters           String?
  columns           String
  groupBy           String?
  sortBy            String?
  chartType         String?
  isPublic          Boolean             @default(false)
  isTemplate        Boolean             @default(false)
  createdBy         String
  churchId          String
  lastRunAt         DateTime?
  runCount          Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now())
  churches          churches            @relation(fields: [churchId], references: [id], onDelete: Cascade)
  report_executions report_executions[]
  report_schedules  report_schedules[]
}

model dashboard_widgets {
  id                   String               @id
  dashboardId          String
  name                 String
  type                 String
  chartType            String?
  dataSource           String
  filters              String?
  position             String
  refreshInterval      Int                  @default(300)
  isVisible            Boolean              @default(true)
  config               String?
  churchId             String
  createdAt            DateTime             @default(now())
  updatedAt            DateTime             @default(now())
  churches             churches             @relation(fields: [churchId], references: [id], onDelete: Cascade)
  analytics_dashboards analytics_dashboards @relation(fields: [dashboardId], references: [id], onDelete: Cascade)
}

model donation_campaigns {
  id                  String               @id
  name                String
  description         String?
  goal                Float
  currency            String               @default("COP")
  startDate           DateTime
  endDate             DateTime?
  status              String               @default("ACTIVA")
  isPublic            Boolean              @default(true)
  churchId            String
  categoryId          String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now())
  donation_categories donation_categories? @relation(fields: [categoryId], references: [id])
  churches            churches             @relation(fields: [churchId], references: [id], onDelete: Cascade)
  donations           donations[]
}

model donation_categories {
  id                 String               @id
  name               String
  description        String?
  churchId           String
  isActive           Boolean              @default(true)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now())
  donation_campaigns donation_campaigns[]
  churches           churches             @relation(fields: [churchId], references: [id], onDelete: Cascade)
  donations          donations[]
  online_payments    online_payments[]
}

model donations {
  id                  String              @id
  amount              Float
  currency            String              @default("COP")
  donorName           String?
  donorEmail          String?
  donorPhone          String?
  memberId            String?
  categoryId          String
  paymentMethodId     String
  reference           String?
  notes               String?
  isAnonymous         Boolean             @default(false)
  status              String              @default("COMPLETADA")
  donationDate        DateTime            @default(now())
  churchId            String
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @default(now())
  campaignId          String?
  donation_campaigns  donation_campaigns? @relation(fields: [campaignId], references: [id])
  donation_categories donation_categories @relation(fields: [categoryId], references: [id])
  churches            churches            @relation(fields: [churchId], references: [id], onDelete: Cascade)
  members             members?            @relation(fields: [memberId], references: [id])
  payment_methods     payment_methods     @relation(fields: [paymentMethodId], references: [id])
  online_payments     online_payments?

  @@index([campaignId, createdAt])
  @@index([churchId, categoryId, createdAt])
  @@index([churchId, donationDate, status])
  @@index([churchId, memberId, createdAt, amount])
}

model event_resource_reservations {
  id              String          @id
  resourceId      String
  eventId         String
  startTime       DateTime
  endTime         DateTime
  notes           String?
  status          String          @default("CONFIRMADA")
  reservedBy      String
  churchId        String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @default(now())
  churches        churches        @relation(fields: [churchId], references: [id], onDelete: Cascade)
  events          events          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  event_resources event_resources @relation(fields: [resourceId], references: [id], onDelete: Cascade)
}

model event_resources {
  id                          String                        @id
  name                        String
  description                 String?
  type                        String
  capacity                    Int?
  isActive                    Boolean                       @default(true)
  churchId                    String
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime                      @default(now())
  event_resource_reservations event_resource_reservations[]
  churches                    churches                      @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model events {
  id                          String                        @id
  title                       String
  description                 String?
  startDate                   DateTime
  endDate                     DateTime?
  location                    String?
  capacity                    Int?
  budget                      Float?
  category                    String                        @default("GENERAL")
  status                      String                        @default("PLANIFICANDO")
  churchId                    String
  createdBy                   String?
  isPublic                    Boolean                       @default(true)
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime                      @default(now())
  check_ins                   check_ins[]
  children_check_ins          children_check_ins[]
  event_resource_reservations event_resource_reservations[]
  churches                    churches                      @relation(fields: [churchId], references: [id], onDelete: Cascade)
  users                       users?                        @relation(fields: [createdBy], references: [id])
  volunteer_assignments       volunteer_assignments[]
  volunteer_recommendations   volunteer_recommendations[]

  @@index([churchId, startDate, endDate])
  @@index([churchId, status, startDate, category])
  @@index([createdBy, churchId, startDate])
}

model funnel_conversions {
  id           String        @id
  email        String
  firstName    String?
  lastName     String?
  phone        String?
  data         Json?
  source       String?
  ipAddress    String?
  userAgent    String?
  funnelId     String
  stepId       String?
  createdAt    DateTime      @default(now())
  funnels      funnels       @relation(fields: [funnelId], references: [id], onDelete: Cascade)
  funnel_steps funnel_steps? @relation(fields: [stepId], references: [id])
}

model funnel_steps {
  id                 String               @id
  name               String
  slug               String
  content            Json
  type               FunnelStepType
  order              Int                  @default(0)
  settings           Json
  funnelId           String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now())
  funnel_conversions funnel_conversions[]
  funnels            funnels              @relation(fields: [funnelId], references: [id], onDelete: Cascade)

  @@unique([funnelId, slug])
}

model funnels {
  id                 String               @id
  name               String
  slug               String
  description        String?
  type               FunnelType
  config             Json
  isActive           Boolean              @default(true)
  isPublished        Boolean              @default(false)
  websiteId          String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now())
  funnel_conversions funnel_conversions[]
  funnel_steps       funnel_steps[]
  websites           websites             @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@unique([websiteId, slug])
}

model integration_configs {
  id        String   @id
  service   String
  config    String
  isActive  Boolean  @default(false)
  churchId  String
  createdAt DateTime @default(now())
  updatedAt DateTime
  churches  churches @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model invoice_communications {
  id        String   @id
  invoiceId String
  type      String
  direction String
  subject   String?
  message   String
  sentBy    String?
  sentTo    String?
  status    String   @default("SENT")
  metadata  Json?
  createdAt DateTime @default(now())
  invoices  invoices @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  users     users?   @relation(fields: [sentBy], references: [id])

  @@index([invoiceId])
  @@index([type])
}

model invoice_line_items {
  id          String   @id
  invoiceId   String
  description String
  quantity    Int      @default(1)
  unitPrice   Float
  totalPrice  Float
  metadata    Json?
  createdAt   DateTime @default(now())
  invoices    invoices @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
}

model invoice_payments {
  id            String    @id
  invoiceId     String
  amount        Float
  currency      String    @default("USD")
  paymentMethod String
  reference     String?
  notes         String?
  verifiedBy    String?
  verifiedAt    DateTime?
  createdAt     DateTime  @default(now())
  invoices      invoices  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  users         users?    @relation(fields: [verifiedBy], references: [id])

  @@index([invoiceId])
}

model invoices {
  id                     String                   @id
  invoiceNumber          String                   @unique
  churchId               String
  subscriptionId         String?
  status                 String                   @default("DRAFT")
  type                   String                   @default("SUBSCRIPTION")
  currency               String                   @default("USD")
  subtotal               Float
  taxAmount              Float                    @default(0.0)
  totalAmount            Float
  dueDate                DateTime
  isRecurrent            Boolean                  @default(false)
  recurrentConfig        Json?
  notes                  String?
  pdfPath                String?
  sentAt                 DateTime?
  paidAt                 DateTime?
  createdBy              String
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @default(now())
  invoice_communications invoice_communications[]
  invoice_line_items     invoice_line_items[]
  invoice_payments       invoice_payments[]
  churches               churches                 @relation(fields: [churchId], references: [id], onDelete: Cascade)
  users                  users                    @relation(fields: [createdBy], references: [id])
  church_subscriptions   church_subscriptions?    @relation(fields: [subscriptionId], references: [id])

  @@index([churchId])
  @@index([dueDate])
  @@index([invoiceNumber])
  @@index([status])
}

model kpi_metrics {
  id             String   @id
  name           String
  description    String?
  category       String
  metricType     String
  dataSource     String
  target         Float?
  currentValue   Float
  previousValue  Float?
  changePercent  Float?
  trendDirection String?
  color          String   @default("blue")
  icon           String?
  unit           String?
  period         String   @default("MONTHLY")
  isActive       Boolean  @default(true)
  churchId       String
  lastCalculated DateTime @default(now())
  createdAt      DateTime @default(now())
  updatedAt      DateTime
  churches       churches @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model marketing_campaign_posts {
  id                    String                @id
  campaignId            String
  postId                String
  accountId             String
  order                 Int                   @default(0)
  scheduledAt           DateTime?
  publishedAt           DateTime?
  status                String                @default("PENDING")
  metrics               String?
  notes                 String?
  churchId              String
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @default(now())
  social_media_accounts social_media_accounts @relation(fields: [accountId], references: [id], onDelete: Cascade)
  marketing_campaigns   marketing_campaigns   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  churches              churches              @relation(fields: [churchId], references: [id], onDelete: Cascade)
  social_media_posts    social_media_posts    @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([campaignId, postId, accountId])
}

model marketing_campaigns {
  id                       String                     @id
  name                     String
  description              String?
  objectives               String?
  targetAudience           String?
  budget                   Float?
  currency                 String                     @default("USD")
  startDate                DateTime
  endDate                  DateTime?
  status                   String                     @default("DRAFT")
  platforms                String
  metrics                  String?
  tags                     String?
  managerId                String
  churchId                 String
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @default(now())
  marketing_campaign_posts marketing_campaign_posts[]
  churches                 churches                   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  social_media_posts       social_media_posts[]
}

model member_behavioral_patterns {
  id                      String          @id
  memberJourneyId         String
  churchId                String
  averageWeeklyAttendance Float           @default(0.0)
  attendanceConsistency   Float           @default(0.0)
  preferredEventTypes     Json
  attendanceTrend         String          @default("stable")
  communicationEngagement Float           @default(0.0)
  eventParticipation      Float           @default(0.0)
  ministryParticipation   Float           @default(0.0)
  socialInteraction       Float           @default(0.0)
  givingFrequency         String?
  givingTrend             String          @default("none")
  averageDonationAmount   Float?          @default(0.0)
  givingConsistency       Float           @default(0.0)
  spiritualGrowthActivity Float           @default(0.0)
  leadershipPotential     Float           @default(0.0)
  mentorshipEngagement    Float           @default(0.0)
  communityBuilding       Float           @default(0.0)
  readinessForNextStage   Float           @default(0.0)
  stagnationRisk          Float           @default(0.0)
  dropoutRisk             Float           @default(0.0)
  analyzedAt              DateTime        @default(now())
  createdAt               DateTime        @default(now())
  updatedAt               DateTime        @default(now())
  churches                churches        @relation(fields: [churchId], references: [id], onDelete: Cascade)
  member_journeys         member_journeys @relation(fields: [memberJourneyId], references: [id], onDelete: Cascade)

  @@index([churchId])
  @@index([dropoutRisk])
  @@index([memberJourneyId])
  @@index([readinessForNextStage])
}

model member_journeys {
  id                               String                             @id
  memberId                         String?                            @unique
  visitorId                        String?                            @unique
  churchId                         String
  currentStage                     MemberLifecycleStage               @default(VISITOR)
  previousStage                    MemberLifecycleStage?
  stageStartDate                   DateTime                           @default(now())
  totalDaysInCurrentStage          Int                                @default(0)
  stageHistory                     Json
  conversionMilestones             Json
  engagementTimeline               Json
  engagementScore                  Float                              @default(0.0)
  engagementLevel                  EngagementLevel                    @default(LOW)
  retentionScore                   Float                              @default(50.0)
  retentionRisk                    RetentionRisk                      @default(MEDIUM)
  attendancePattern                Json
  ministryInvolvement              Json
  givingPattern                    Json
  communicationResponse            Json
  nextStageRecommendation          MemberLifecycleStage?
  nextStageProbability             Float?
  recommendedActions               Json
  pathwayRecommendations           Json
  behavioralProfile                Json
  growthPredictions                Json
  riskFactors                      Json
  strengthFactors                  Json
  createdAt                        DateTime                           @default(now())
  updatedAt                        DateTime                           @default(now())
  lastAnalysisDate                 DateTime                           @default(now())
  member_behavioral_patterns       member_behavioral_patterns[]
  churches                         churches                           @relation(fields: [churchId], references: [id], onDelete: Cascade)
  members                          members?                           @relation(fields: [memberId], references: [id])
  ministry_pathway_recommendations ministry_pathway_recommendations[]

  @@index([churchId, currentStage])
  @@index([currentStage])
  @@index([engagementLevel])
  @@index([lastAnalysisDate])
  @@index([retentionRisk])
}

model member_spiritual_profiles {
  id                          String    @id
  memberId                    String    @unique
  primaryGifts                Json
  secondaryGifts              Json
  spiritualCalling            String?
  ministryPassions            Json
  experienceLevel             Int       @default(1)
  leadershipScore             Int       @default(1)
  servingMotivation           String?
  previousExperience          Json?
  trainingCompleted           Json?
  spiritualMaturityScore      Int       @default(50)
  leadershipAptitudeScore     Int       @default(50)
  ministryPassionScore        Int       @default(50)
  availabilityScore           Int       @default(50)
  teachingAbility             Int       @default(50)
  pastoralHeart               Int       @default(50)
  organizationalSkills        Int       @default(50)
  communicationSkills         Int       @default(50)
  leadershipTrainingCompleted Boolean   @default(false)
  leadershipTrainingDate      DateTime?
  mentoringExperience         Boolean   @default(false)
  discipleshipTraining        Boolean   @default(false)
  volunteerReadinessScore     Int       @default(0)
  leadershipReadinessScore    Int       @default(0)
  assessmentDate              DateTime  @default(now())
  createdAt                   DateTime  @default(now())
  updatedAt                   DateTime  @default(now())
  members                     members   @relation(fields: [memberId], references: [id], onDelete: Cascade)
}

model members {
  id                        String                      @id
  firstName                 String
  lastName                  String
  email                     String?
  phone                     String?
  address                   String?
  city                      String?
  state                     String?
  zipCode                   String?
  birthDate                 DateTime?
  baptismDate               DateTime?
  membershipDate            DateTime?
  maritalStatus             String?
  gender                    String?
  occupation                String?
  photo                     String?
  notes                     String?
  churchId                  String
  userId                    String?                     @unique
  ministryId                String?
  isActive                  Boolean                     @default(true)
  spiritualGifts            Json?
  secondaryGifts            Json?
  spiritualCalling          String?
  ministryPassion           Json?
  experienceLevel           Int?                        @default(1)
  availabilityScore         Float?                      @default(0.0)
  leadershipReadiness       Int?                        @default(1)
  skillsMatrix              Json?
  personalityType           String?
  transportationOwned       Boolean?                    @default(false)
  childcareAvailable        Boolean?                    @default(false)
  backgroundCheckDate       DateTime?
  emergencyContact          String?
  spiritualGiftsStructured  Json?
  experienceLevelEnum       ExperienceLevel?
  leadershipStage           LeadershipStage?            @default(VOLUNTEER)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @default(now())
  ai_prediction_records     ai_prediction_records[]
  availability_matrices     availability_matrices?
  donations                 donations[]
  member_journeys           member_journeys?
  member_spiritual_profiles member_spiritual_profiles?
  churches                  churches                    @relation(fields: [churchId], references: [id], onDelete: Cascade)
  ministries                ministries?                 @relation(fields: [ministryId], references: [id])
  users                     users?                      @relation(fields: [userId], references: [id])
  visitor_profiles          visitor_profiles[]
  volunteer_recommendations volunteer_recommendations[]
  volunteers                volunteers[]

  @@index([churchId, email])
  @@index([churchId, firstName, lastName])
  @@index([churchId, isActive, createdAt])
  @@index([membershipDate, isActive])
}

model ministries {
  id                        String                      @id
  name                      String
  description               String?
  churchId                  String
  isActive                  Boolean                     @default(true)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @default(now())
  members                   members[]
  churches                  churches                    @relation(fields: [churchId], references: [id], onDelete: Cascade)
  ministry_gap_analyses     ministry_gap_analyses[]
  volunteer_recommendations volunteer_recommendations[]
  volunteers                volunteers[]
}

model ministry_gap_analyses {
  id                 String     @id
  ministryId         String
  churchId           String
  analysisDate       DateTime   @default(now())
  gapsIdentified     Json
  urgencyScore       Int
  recommendedActions Json
  currentStaffing    Int
  optimalStaffing    Int
  gapPercentage      Float
  seasonalFactor     Float      @default(1.0)
  status             String     @default("ACTIVE")
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @default(now())
  churches           churches   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  ministries         ministries @relation(fields: [ministryId], references: [id], onDelete: Cascade)
}

model ministry_pathway_recommendations {
  id                  String          @id
  memberJourneyId     String
  churchId            String
  recommendationType  String
  title               String
  description         String
  priority            String          @default("medium")
  matchScore          Float           @default(0.0)
  basedOnFactors      Json
  spiritualGiftsMatch Float           @default(0.0)
  availabilityMatch   Float           @default(0.0)
  experienceMatch     Float           @default(0.0)
  ministryCategory    String?
  requiredSkills      Json
  timeCommitment      String?
  difficultyLevel     String          @default("beginner")
  status              String          @default("pending")
  presentedAt         DateTime?
  respondedAt         DateTime?
  completedAt         DateTime?
  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @default(now())
  churches            churches        @relation(fields: [churchId], references: [id], onDelete: Cascade)
  member_journeys     member_journeys @relation(fields: [memberJourneyId], references: [id], onDelete: Cascade)

  @@index([churchId])
  @@index([memberJourneyId])
  @@index([priority])
  @@index([status])
}

model notification_deliveries {
  id             String        @id
  notificationId String
  userId         String
  isRead         Boolean       @default(false)
  readAt         DateTime?
  deliveredAt    DateTime?
  deliveryMethod String?
  deliveryStatus String        @default("PENDING")
  failureReason  String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  notifications  notifications @relation(fields: [notificationId], references: [id], onDelete: Cascade)
  users          users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([notificationId, userId, deliveryMethod])
  @@index([notificationId])
  @@index([userId, isRead])
}

model notification_preferences {
  id                   String   @id
  userId               String   @unique
  emailEnabled         Boolean  @default(true)
  emailEvents          Boolean  @default(true)
  emailDonations       Boolean  @default(true)
  emailCommunications  Boolean  @default(true)
  emailSystemUpdates   Boolean  @default(true)
  inAppEnabled         Boolean  @default(true)
  inAppEvents          Boolean  @default(true)
  inAppDonations       Boolean  @default(true)
  inAppCommunications  Boolean  @default(true)
  inAppSystemUpdates   Boolean  @default(true)
  pushEnabled          Boolean  @default(false)
  pushEvents           Boolean  @default(true)
  pushDonations        Boolean  @default(false)
  pushCommunications   Boolean  @default(true)
  pushSystemUpdates    Boolean  @default(true)
  quietHoursEnabled    Boolean  @default(false)
  quietHoursStart      String?
  quietHoursEnd        String?
  weekendNotifications Boolean  @default(true)
  digestEnabled        Boolean  @default(false)
  digestFrequency      String   @default("DAILY")
  createdAt            DateTime @default(now())
  updatedAt            DateTime @default(now())
  users                users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model notification_templates {
  id                String    @id
  name              String
  description       String?
  category          String
  type              String    @default("INFO")
  priority          String    @default("NORMAL")
  titleTemplate     String
  messageTemplate   String
  actionLabel       String?
  isActive          Boolean   @default(true)
  isSystem          Boolean   @default(false)
  defaultTargetRole String?
  churchId          String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @default(now())
  churches          churches? @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@unique([name, churchId])
}

model notifications {
  id                      String                    @id
  title                   String
  message                 String
  type                    String
  category                String?
  targetRole              String?
  targetUser              String?
  isGlobal                Boolean                   @default(false)
  priority                String                    @default("NORMAL")
  actionUrl               String?
  actionLabel             String?
  expiresAt               DateTime?
  churchId                String
  createdBy               String?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime                  @default(now())
  notification_deliveries notification_deliveries[]
  churches                churches                  @relation(fields: [churchId], references: [id], onDelete: Cascade)
  users                   users?                    @relation(fields: [createdBy], references: [id])
}

model online_payments {
  id                  String               @id
  paymentId           String               @unique
  amount              Float
  currency            String               @default("COP")
  gatewayType         String
  status              String               @default("pending")
  donorName           String?
  donorEmail          String?
  donorPhone          String?
  donationId          String?              @unique
  churchId            String
  categoryId          String?
  reference           String?
  gatewayReference    String?
  redirectUrl         String?
  returnUrl           String?
  notes               String?
  metadata            Json?
  webhookReceived     Boolean              @default(false)
  completedAt         DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @default(now())
  donation_categories donation_categories? @relation(fields: [categoryId], references: [id])
  churches            churches             @relation(fields: [churchId], references: [id], onDelete: Cascade)
  donations           donations?           @relation(fields: [donationId], references: [id])

  @@index([churchId])
  @@index([paymentId])
  @@index([status])
}

model payment_gateway_configs {
  id            String   @id
  gatewayType   String
  churchId      String
  isEnabled     Boolean  @default(false)
  isTestMode    Boolean  @default(true)
  merchantId    String?
  apiKey        String?
  clientId      String?
  clientSecret  String?
  webhookSecret String?
  configuration Json?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
  churches      churches @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@unique([churchId, gatewayType])
}

model payment_methods {
  id          String      @id
  name        String
  description String?
  isDigital   Boolean     @default(false)
  churchId    String
  isActive    Boolean     @default(true)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @default(now())
  donations   donations[]
  churches    churches    @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model permissions {
  id               String             @id
  name             String             @unique
  description      String?
  resource         String
  action           String
  conditions       String?
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @default(now())
  role_permissions role_permissions[]
  user_permissions user_permissions[]

  @@unique([resource, action])
}

model plan_features {
  id          String   @id
  key         String   @unique
  name        String
  description String?
  category    String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @default(now())
}

model platform_settings {
  id                 String   @id @default("default")
  currency           String   @default("USD")
  taxRate            Float    @default(0.0)
  freeTrialDays      Int      @default(14)
  gracePeriodDays    Int      @default(7)
  platformName       String   @default("Kesed-tek Church Management Systems")
  supportEmail       String   @default("soporte@khesedtek.com")
  maintenanceMode    Boolean  @default(false)
  allowRegistrations Boolean  @default(true)
  createdAt          DateTime @default(now())
  updatedAt          DateTime
}

model prayer_approvals {
  id              String          @id
  requestId       String          @unique
  contactId       String
  approvedBy      String
  status          String          @default("pending")
  notes           String?
  approvedAt      DateTime?
  churchId        String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @default(now())
  users           users           @relation(fields: [approvedBy], references: [id])
  churches        churches        @relation(fields: [churchId], references: [id], onDelete: Cascade)
  prayer_contacts prayer_contacts @relation(fields: [contactId], references: [id], onDelete: Cascade)
  prayer_requests prayer_requests @relation(fields: [requestId], references: [id], onDelete: Cascade)
}

model prayer_categories {
  id                        String                      @id
  name                      String
  description               String?
  icon                      String?
  color                     String?
  isActive                  Boolean                     @default(true)
  churchId                  String
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @default(now())
  churches                  churches                    @relation(fields: [churchId], references: [id], onDelete: Cascade)
  prayer_requests           prayer_requests[]
  prayer_response_templates prayer_response_templates[]

  @@unique([churchId, name])
}

model prayer_contacts {
  id                 String               @id
  fullName           String
  phone              String?
  email              String?
  preferredContact   String               @default("sms")
  churchId           String
  source             String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now())
  prayer_approvals   prayer_approvals[]
  churches           churches             @relation(fields: [churchId], references: [id], onDelete: Cascade)
  prayer_requests    prayer_requests[]
  prayer_testimonies prayer_testimonies[]

  @@unique([churchId, phone, email])
}

model prayer_forms {
  id              String            @id
  name            String
  description     String?
  fields          Json
  style           Json?
  isActive        Boolean           @default(true)
  isPublic        Boolean           @default(true)
  slug            String            @unique
  churchId        String
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @default(now())
  churches        churches          @relation(fields: [churchId], references: [id], onDelete: Cascade)
  prayer_qr_codes prayer_qr_codes[]
}

model prayer_qr_codes {
  id           String       @id
  name         String
  description  String?
  formId       String
  code         String       @unique
  design       Json?
  isActive     Boolean      @default(true)
  scanCount    Int          @default(0)
  lastScan     DateTime?
  churchId     String
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @default(now())
  churches     churches     @relation(fields: [churchId], references: [id], onDelete: Cascade)
  prayer_forms prayer_forms @relation(fields: [formId], references: [id], onDelete: Cascade)
}

model prayer_requests {
  id                    String               @id
  contactId             String
  churchId              String
  categoryId            String
  message               String
  isAnonymous           Boolean              @default(false)
  status                String               @default("pending")
  priority              String               @default("normal")
  source                String?
  formId                String?
  qrCodeId              String?
  automationTriggered   Boolean              @default(false)
  triggeredRuleIds      String[]             @default([])
  lastAutomationRun     DateTime?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime             @default(now())
  prayer_approvals      prayer_approvals?
  prayer_categories     prayer_categories    @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  churches              churches             @relation(fields: [churchId], references: [id], onDelete: Cascade)
  prayer_contacts       prayer_contacts      @relation(fields: [contactId], references: [id], onDelete: Cascade)
  prayer_testimonies    prayer_testimonies[]
  
  @@index([automationTriggered])
}

model prayer_response_templates {
  id                String            @id
  categoryId        String
  title             String
  message           String
  smsMessage        String?
  isActive          Boolean           @default(true)
  isDefault         Boolean           @default(false)
  churchId          String
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @default(now())
  prayer_categories prayer_categories @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  churches          churches          @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model prayer_testimonies {
  id              String           @id
  title           String
  message         String
  contactId       String?
  prayerRequestId String?
  category        String           @default("general")
  isAnonymous     Boolean          @default(false)
  status          String           @default("pending")
  isPublic        Boolean          @default(false)
  imageUrl        String?
  tags            Json?
  churchId        String
  formId          String?
  qrCodeId        String?
  approvedBy      String?
  approvedAt      DateTime?
  submittedAt     DateTime         @default(now())
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @default(now())
  users           users?           @relation(fields: [approvedBy], references: [id])
  churches        churches         @relation(fields: [churchId], references: [id], onDelete: Cascade)
  prayer_contacts prayer_contacts? @relation(fields: [contactId], references: [id])
  prayer_requests prayer_requests? @relation(fields: [prayerRequestId], references: [id])
}

model push_notification_logs {
  id               String    @id
  churchId         String
  userId           String?
  title            String
  body             String
  payload          Json?
  status           String    @default("PENDING")
  deliveryAttempts Int       @default(0)
  lastAttempt      DateTime?
  error            String?
  clickedAt        DateTime?
  dismissedAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @default(now())
  churches         churches  @relation(fields: [churchId], references: [id], onDelete: Cascade)
  users            users?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([churchId])
  @@index([createdAt])
  @@index([status])
  @@index([userId])
}

model push_subscriptions {
  id        String   @id
  userId    String
  churchId  String
  endpoint  String
  p256dh    String
  auth      String
  isActive  Boolean  @default(true)
  userAgent String?
  platform  String?
  language  String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  churches  churches @relation(fields: [churchId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, endpoint])
  @@index([churchId])
  @@index([isActive])
  @@index([userId])
}

model report_executions {
  id             String         @id
  reportId       String
  status         String
  format         String
  fileUrl        String?
  parameters     String?
  rowCount       Int?
  executionTime  Int?
  errorMessage   String?
  executedBy     String?
  churchId       String
  createdAt      DateTime       @default(now())
  completedAt    DateTime?
  churches       churches       @relation(fields: [churchId], references: [id], onDelete: Cascade)
  custom_reports custom_reports @relation(fields: [reportId], references: [id], onDelete: Cascade)
}

model report_schedules {
  id             String         @id
  reportId       String
  frequency      String
  dayOfWeek      Int?
  dayOfMonth     Int?
  time           String
  recipients     String
  format         String         @default("PDF")
  isActive       Boolean        @default(true)
  lastSent       DateTime?
  nextScheduled  DateTime?
  churchId       String
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @default(now())
  churches       churches       @relation(fields: [churchId], references: [id], onDelete: Cascade)
  custom_reports custom_reports @relation(fields: [reportId], references: [id], onDelete: Cascade)
}

model role_permissions {
  id           String      @id
  roleId       String
  permissionId String
  conditions   String?
  createdAt    DateTime    @default(now())
  permissions  permissions @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  roles        roles       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
}

model roles {
  id                  String                @id
  name                String
  description         String?
  churchId            String?
  isSystem            Boolean               @default(false)
  isActive            Boolean               @default(true)
  priority            Int                   @default(0)
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @default(now())
  role_permissions    role_permissions[]
  churches            churches?             @relation(fields: [churchId], references: [id], onDelete: Cascade)
  user_roles_advanced user_roles_advanced[]

  @@unique([name, churchId])
}

model sermons {
  id        String    @id
  title     String
  content   String?
  outline   String?
  scripture String?
  date      DateTime?
  speaker   String?
  churchId  String
  isPublic  Boolean   @default(false)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now())
  churches  churches  @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model sessions {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model social_media_accounts {
  id                       String                     @id
  platform                 String
  accountId                String
  username                 String?
  displayName              String?
  accessToken              String
  refreshToken             String?
  tokenExpiresAt           DateTime?
  isActive                 Boolean                    @default(true)
  lastSync                 DateTime?
  accountData              String?
  churchId                 String
  connectedBy              String
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @default(now())
  marketing_campaign_posts marketing_campaign_posts[]
  churches                 churches                   @relation(fields: [churchId], references: [id], onDelete: Cascade)
  social_media_metrics     social_media_metrics[]

  @@unique([platform, accountId, churchId])
}

model social_media_metrics {
  id                    String                @id
  accountId             String
  postId                String?
  campaignId            String?
  platform              String
  metricType            String
  value                 Float
  date                  DateTime
  periodType            String                @default("DAILY")
  metadata              String?
  churchId              String
  collectedAt           DateTime              @default(now())
  createdAt             DateTime              @default(now())
  social_media_accounts social_media_accounts @relation(fields: [accountId], references: [id], onDelete: Cascade)
  churches              churches              @relation(fields: [churchId], references: [id], onDelete: Cascade)

  @@unique([accountId, postId, metricType, date, periodType])
}

model social_media_posts {
  id                       String                     @id
  title                    String?
  content                  String
  mediaUrls                String?
  platforms                String
  accountIds               String
  status                   String                     @default("DRAFT")
  scheduledAt              DateTime?
  publishedAt              DateTime?
  postIds                  String?
  engagement               String?
  hashtags                 String?
  mentions                 String?
  campaignId               String?
  authorId                 String
  churchId                 String
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime                   @default(now())
  marketing_campaign_posts marketing_campaign_posts[]
  marketing_campaigns      marketing_campaigns?       @relation(fields: [campaignId], references: [id])
  churches                 churches                   @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

model spiritual_gifts {
  id          String   @id
  name        String   @unique
  category    String
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model subscription_addons {
  id                         String                       @id
  key                        String                       @unique
  name                       String
  description                String?
  priceMonthly               String
  priceYearly                String?
  billingType                String                       @default("MONTHLY")
  pricePerUnit               String?
  unit                       String?
  isActive                   Boolean                      @default(true)
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @default(now())
  church_subscription_addons church_subscription_addons[]
}

model subscription_plans {
  id                   String                 @id
  name                 String                 @unique
  displayName          String
  description          String?
  priceMonthly         String
  priceYearly          String?
  maxChurches          Int                    @default(1)
  maxMembers           Int                    @default(100)
  maxUsers             Int                    @default(5)
  isActive             Boolean                @default(true)
  sortOrder            Int                    @default(0)
  features             Json?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @default(now())
  church_subscriptions church_subscriptions[]
}

model support_contact_info {
  id             String   @id @default("default")
  whatsappNumber String   @default("+57 300 KHESED (543733)")
  whatsappUrl    String   @default("https://wa.me/573003435733")
  email          String   @default("soporte@khesedtek.com")
  schedule       String   @default("Lun-Vie 8AM-8PM (Colombia)")
  companyName    String   @default("Khesed-tek Systems")
  location       String   @default("Bogot, Colombia")
  website        String   @default("https://khesedtek.com")
  createdAt      DateTime @default(now())
  updatedAt      DateTime
}

model tenant_credentials {
  id           String    @id
  churchId     String    @unique
  loginEmail   String
  tempPassword String?
  isFirstLogin Boolean   @default(true)
  sentAt       DateTime?
  lastSentAt   DateTime?
  createdBy    String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now())
  churches     churches  @relation(fields: [churchId], references: [id], onDelete: Cascade)
  users        users     @relation(fields: [createdBy], references: [id])
}

model testimony_forms {
  id                 String               @id
  name               String
  description        String?
  fields             Json
  style              Json?
  isActive           Boolean              @default(true)
  isPublic           Boolean              @default(true)
  slug               String               @unique
  churchId           String
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now())
  churches           churches             @relation(fields: [churchId], references: [id], onDelete: Cascade)
  testimony_qr_codes testimony_qr_codes[]
}

model testimony_qr_codes {
  id              String          @id
  name            String
  description     String?
  formId          String
  code            String          @unique
  design          Json?
  isActive        Boolean         @default(true)
  scanCount       Int             @default(0)
  lastScan        DateTime?
  churchId        String
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @default(now())
  churches        churches        @relation(fields: [churchId], references: [id], onDelete: Cascade)
  testimony_forms testimony_forms @relation(fields: [formId], references: [id], onDelete: Cascade)
}

model user_permissions {
  id           String      @id
  userId       String
  permissionId String
  granted      Boolean     @default(true)
  conditions   String?
  expiresAt    DateTime?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @default(now())
  permissions  permissions @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  users        users       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId])
}

model user_roles_advanced {
  id        String    @id
  userId    String
  roleId    String
  isActive  Boolean   @default(true)
  expiresAt DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @default(now())
  roles     roles     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  users     users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
}

model user_theme_preferences {
  id                   String    @id
  userId               String    @unique
  churchId             String?
  themeName            String    @default("default")
  themeMode            String    @default("light")
  primaryColor         String?
  secondaryColor       String?
  accentColor          String?
  destructiveColor     String?
  backgroundColor      String?
  foregroundColor      String?
  cardColor            String?
  cardForegroundColor  String?
  borderColor          String?
  mutedColor           String?
  mutedForegroundColor String?
  fontFamily           String?   @default("Inter")
  fontSize             String?   @default("medium")
  borderRadius         String?   @default("0.5rem")
  compactMode          Boolean   @default(false)
  logoUrl              String?
  faviconUrl           String?
  brandName            String?
  isActive             Boolean   @default(true)
  isPublic             Boolean   @default(false)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime
  churches             churches? @relation(fields: [churchId], references: [id], onDelete: Cascade)
  users                users     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model users {
  id                                     String                                   @id
  name                                   String?
  email                                  String                                   @unique
  emailVerified                          DateTime?
  image                                  String?
  password                               String?
  role                                   UserRole                                 @default(MIEMBRO)
  churchId                               String?
  isActive                               Boolean                                  @default(true)
  isFirstLogin                           Boolean                                  @default(false)
  lastPasswordChange                     DateTime?
  phone                                  String?
  location                               String?
  bio                                    String?
  createdAt                              DateTime                                 @default(now())
  updatedAt                              DateTime
  accounts                               accounts[]
  automation_rule_template_installations automation_rule_template_installations[]
  automation_rule_templates              automation_rule_templates[]
  automation_rules                       automation_rules[]
  automation_templates                   automation_templates[]
  custom_forms                           custom_forms[]
  events                                 events[]
  invoice_communications                 invoice_communications[]
  invoice_payments                       invoice_payments[]
  invoices                               invoices[]
  members                                members?
  notification_deliveries                notification_deliveries[]
  notification_preferences               notification_preferences?
  notifications                          notifications[]
  prayer_approvals                       prayer_approvals[]
  prayer_testimonies                     prayer_testimonies[]
  push_notification_logs                 push_notification_logs[]
  push_subscriptions                     push_subscriptions[]
  sessions                               sessions[]
  tenant_credentials                     tenant_credentials[]
  user_permissions                       user_permissions[]
  user_roles_advanced                    user_roles_advanced[]
  user_theme_preferences                 user_theme_preferences?
  churches                               churches?                                @relation(fields: [churchId], references: [id], onDelete: Cascade)
  visitor_follow_ups                     visitor_follow_ups[]
  visitor_profiles                       visitor_profiles[]
  website_requests                       website_requests[]
  // Platform form relationships
  platformFormsCreated                   PlatformForm[]                           @relation("PlatformFormCreatedBy")
  platformSubmissionsProcessed           PlatformFormSubmission[]                 @relation("PlatformSubmissionProcessedBy")
  platformQRCodesGenerated               PlatformQRCode[]                         @relation("PlatformQRGeneratedBy")
  qrCodesCreated                         qr_codes[]                               @relation("QRCodeCreatedBy")
}

model verification_tokens {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model visitor_follow_ups {
  id               String            @id
  checkInId        String
  visitorProfileId String?
  followUpType     String
  status           String            @default("PENDIENTE")
  scheduledAt      DateTime?
  completedAt      DateTime?
  notes            String?
  assignedTo       String?
  churchId         String
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @default(now())
  automationRuleId String?
  priority         String            @default("MEDIUM")
  category         String?
  touchSequence    Int?
  responseReceived Boolean           @default(false)
  responseData     Json?
  nextActionDue    DateTime?
  ministryMatch    String?
  users            users?            @relation(fields: [assignedTo], references: [id])
  check_ins        check_ins         @relation(fields: [checkInId], references: [id], onDelete: Cascade)
  churches         churches          @relation(fields: [churchId], references: [id], onDelete: Cascade)
  visitor_profiles visitor_profiles? @relation(fields: [visitorProfileId], references: [id])

  @@index([followUpType])
  @@index([status])
  @@index([visitorProfileId])
}

model visitor_forms {
  id                  String                @id
  name                String
  description         String?
  fields              Json
  style               Json?
  settings            Json?
  isActive            Boolean               @default(true)
  isPublic            Boolean               @default(true)
  slug                String                @unique
  churchId            String
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @default(now())
  churches            churches              @relation(fields: [churchId], references: [id], onDelete: Cascade)
  visitor_qr_codes    visitor_qr_codes[]
  visitor_submissions visitor_submissions[]
}

model visitor_profiles {
  id                 String               @id
  checkInId          String?
  memberId           String?
  fullName           String
  phone              String?
  email              String?
  preferredContact   String               @default("email")
  category           VisitorCategory      @default(FIRST_TIME)
  visitCount         Int                  @default(1)
  lastVisitDate      DateTime             @default(now())
  firstVisitDate     DateTime             @default(now())
  followUpsSent      Int                  @default(0)
  followUpsResponded Int                  @default(0)
  interestAreas      String[]
  prayerRequestsMade Int                  @default(0)
  eventAttendance    Int                  @default(0)
  autoAddedToCRM     Boolean              @default(false)
  crmAddedAt         DateTime?
  assignedStaffId    String?
  source             String?
  notes              String?
  metadata           Json?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @default(now())
  visitor_follow_ups visitor_follow_ups[]
  users              users?               @relation(fields: [assignedStaffId], references: [id])
  members            members?             @relation(fields: [memberId], references: [id])

  @@index([category])
  @@index([email])
  @@index([lastVisitDate])
  @@index([phone])
}

model visitor_qr_codes {
  id            String        @id
  name          String
  description   String?
  formId        String
  code          String        @unique
  design        Json?
  isActive      Boolean       @default(true)
  scanCount     Int           @default(0)
  lastScan      DateTime?
  churchId      String
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now())
  churches      churches      @relation(fields: [churchId], references: [id], onDelete: Cascade)
  visitor_forms visitor_forms @relation(fields: [formId], references: [id], onDelete: Cascade)
}

model visitor_submissions {
  id                    String        @id
  formId                String
  data                  Json
  submittedAt           DateTime      @default(now())
  ipAddress             String?
  userAgent             String?
  status                String        @default("pending")
  churchId              String
  automationTriggered   Boolean       @default(false)
  triggeredRuleIds      String[]      @default([])
  lastAutomationRun     DateTime?
  churches              churches      @relation(fields: [churchId], references: [id])
  visitor_forms         visitor_forms @relation(fields: [formId], references: [id], onDelete: Cascade)

  @@index([churchId, submittedAt])
  @@index([formId, status])
  @@index([automationTriggered])
}

model volunteer_assignments {
  id          String     @id
  volunteerId String
  eventId     String?
  title       String
  description String?
  date        DateTime
  startTime   String
  endTime     String
  status      String     @default("ASIGNADO")
  notes       String?
  churchId    String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @default(now())
  events      events?    @relation(fields: [eventId], references: [id])
  volunteers  volunteers @relation(fields: [volunteerId], references: [id], onDelete: Cascade)
}

model volunteer_engagement_scores {
  id                 String     @id
  volunteerId        String     @unique
  currentScore       Float      @default(0.0)
  participationRate  Float      @default(0.0)
  consistencyScore   Float      @default(0.0)
  feedbackScore      Float      @default(0.0)
  growthTrend        String     @default("STABLE")
  lastActivityDate   DateTime?
  burnoutRisk        String     @default("LOW")
  recommendedActions Json?
  calculatedAt       DateTime   @default(now())
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @default(now())
  volunteers         volunteers @relation(fields: [volunteerId], references: [id], onDelete: Cascade)
}

model volunteer_recommendations {
  id                 String     @id
  memberId           String
  ministryId         String
  eventId            String?
  recommendationType String
  matchScore         Float
  reasoning          Json
  status             String     @default("PENDING")
  priority           String     @default("MEDIUM")
  validUntil         DateTime
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @default(now())
  events             events?    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  members            members    @relation(fields: [memberId], references: [id], onDelete: Cascade)
  ministries         ministries @relation(fields: [ministryId], references: [id], onDelete: Cascade)
}

model volunteers {
  id                          String                       @id
  memberId                    String?
  firstName                   String
  lastName                    String
  email                       String?
  phone                       String?
  skills                      String?
  availability                String?
  ministryId                  String?
  churchId                    String
  isActive                    Boolean                      @default(true)
  createdAt                   DateTime                     @default(now())
  updatedAt                   DateTime                     @default(now())
  volunteer_assignments       volunteer_assignments[]
  volunteer_engagement_scores volunteer_engagement_scores?
  churches                    churches                     @relation(fields: [churchId], references: [id], onDelete: Cascade)
  members                     members?                     @relation(fields: [memberId], references: [id])
  ministries                  ministries?                  @relation(fields: [ministryId], references: [id])

  @@index([churchId, memberId, isActive, createdAt])
  @@index([churchId, ministryId, isActive])
  @@index([email, churchId])
}

model web_page_sections {
  id        String    @id
  type      String
  content   Json
  order     Int       @default(0)
  isVisible Boolean   @default(true)
  pageId    String
  createdAt DateTime  @default(now())
  updatedAt DateTime
  web_pages web_pages @relation(fields: [pageId], references: [id], onDelete: Cascade)
}

model web_pages {
  id                String              @id
  title             String
  slug              String
  content           Json
  metaTitle         String?
  metaDescription   String?
  metaImage         String?
  isHomePage        Boolean             @default(false)
  isPublished       Boolean             @default(false)
  order             Int                 @default(0)
  websiteId         String
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @default(now())
  web_page_sections web_page_sections[]
  websites          websites            @relation(fields: [websiteId], references: [id], onDelete: Cascade)

  @@unique([websiteId, slug])
}

model website_analytics {
  id                 String   @id
  pageViews          Int      @default(0)
  uniqueVisitors     Int      @default(0)
  bounceRate         Float?
  avgSessionDuration Int?
  referrer           String?
  page               String
  date               DateTime @default(now())
  websiteId          String
  createdAt          DateTime @default(now())
  websites           websites @relation(fields: [websiteId], references: [id], onDelete: Cascade)
}

model website_requests {
  id                                                     String    @id
  churchId                                               String
  requestType                                            String
  projectName                                            String
  description                                            String
  status                                                 String    @default("pending")
  priority                                               String    @default("medium")
  contactEmail                                           String
  phone                                                  String?
  estimatedPrice                                         Int?
  finalPrice                                             Int?
  estimatedCompletion                                    DateTime?
  completedAt                                            DateTime?
  adminNotes                                             String?
  metadata                                               String?
  existingWebsiteId                                      String?
  resultingWebsiteId                                     String?
  assignedTo                                             String?
  createdAt                                              DateTime  @default(now())
  updatedAt                                              DateTime  @default(now())
  users                                                  users?    @relation(fields: [assignedTo], references: [id])
  churches                                               churches  @relation(fields: [churchId], references: [id], onDelete: Cascade)
  websites_website_requests_existingWebsiteIdTowebsites  websites? @relation("website_requests_existingWebsiteIdTowebsites", fields: [existingWebsiteId], references: [id])
  websites_website_requests_resultingWebsiteIdTowebsites websites? @relation("website_requests_resultingWebsiteIdTowebsites", fields: [resultingWebsiteId], references: [id])
}

model websites {
  id                                                             String              @id
  name                                                           String
  slug                                                           String              @unique
  domain                                                         String?
  description                                                    String?
  theme                                                          String              @default("default")
  primaryColor                                                   String              @default("#3B82F6")
  secondaryColor                                                 String              @default("#64748B")
  accentColor                                                    String?
  fontFamily                                                     String              @default("Inter")
  metaTitle                                                      String?
  metaDescription                                                String?
  metaImage                                                      String?
  metadata                                                       String?
  isPublished                                                    Boolean             @default(false)
  isActive                                                       Boolean             @default(true)
  churchId                                                       String
  createdAt                                                      DateTime            @default(now())
  updatedAt                                                      DateTime            @default(now())
  funnels                                                        funnels[]
  web_pages                                                      web_pages[]
  website_analytics                                              website_analytics[]
  website_requests_website_requests_existingWebsiteIdTowebsites  website_requests[]  @relation("website_requests_existingWebsiteIdTowebsites")
  website_requests_website_requests_resultingWebsiteIdTowebsites website_requests[]  @relation("website_requests_resultingWebsiteIdTowebsites")
  churches                                                       churches            @relation(fields: [churchId], references: [id], onDelete: Cascade)
}

enum AutomationActionType {
  SEND_NOTIFICATION
  SEND_EMAIL
  SEND_PUSH
  SEND_SMS
  SEND_WHATSAPP
  CREATE_FOLLOW_UP
  ASSIGN_VOLUNTEER
  ASSIGN_STAFF
  UPDATE_MEMBER
  CREATE_EVENT
  CREATE_PRAYER_RESPONSE
  ADD_TO_CRM
  CATEGORIZE_VISITOR
  ESCALATE_TO_SUPERVISOR
  CREATE_MANUAL_TASK
  FIND_BACKUP_VOLUNTEER
  CUSTOM_WEBHOOK
}

enum AutomationConditionType {
  EQUALS
  NOT_EQUALS
  GREATER_THAN
  LESS_THAN
  CONTAINS
  NOT_CONTAINS
  IN
  NOT_IN
  EXISTS
  NOT_EXISTS
  DATE_BEFORE
  DATE_AFTER
  DATE_BETWEEN
  TIME_BEFORE
  TIME_AFTER
  CUSTOM
}

enum AutomationTriggerType {
  MEMBER_JOINED
  DONATION_RECEIVED
  EVENT_CREATED
  EVENT_UPDATED
  ATTENDANCE_RECORDED
  VOLUNTEER_ASSIGNED
  BIRTHDAY
  ANNIVERSARY
  SERMON_PUBLISHED
  COMMUNICATION_SENT
  FOLLOW_UP_DUE
  PRAYER_REQUEST_SUBMITTED
  PRAYER_REQUEST_APPROVED
  VISITOR_CHECKED_IN
  VISITOR_RETURNED
  VISITOR_FIRST_TIME
  CUSTOM_EVENT
  SOCIAL_MEDIA_POST_CREATED
  SOCIAL_MEDIA_POST_PUBLISHED
  SOCIAL_MEDIA_CAMPAIGN_LAUNCHED
  SOCIAL_MEDIA_ACCOUNT_CONNECTED
  SOCIAL_MEDIA_ENGAGEMENT_THRESHOLD
  SOCIAL_MEDIA_SCHEDULED_POST_READY
  SOCIAL_MEDIA_CAMPAIGN_COMPLETED
  SOCIAL_MEDIA_ANALYTICS_REPORT
  FORM_SUBMITTED
  QR_CODE_SCANNED
  VISITOR_FORM_SUBMITTED
  PRAYER_FORM_SUBMITTED
}

enum EngagementLevel {
  HIGH
  MEDIUM_HIGH
  MEDIUM
  MEDIUM_LOW
  LOW
}

enum ExperienceLevel {
  NOVATO
  INTERMEDIO
  AVANZADO
}

enum FunnelStepType {
  LANDING_PAGE
  OPT_IN
  THANK_YOU
  SALES_PAGE
  CHECKOUT
  CONFIRMATION
  CUSTOM
}

enum FunnelType {
  LEAD_GENERATION
  EVENT_REGISTRATION
  DONATION
  NEWSLETTER
  CUSTOM
}

enum LeadershipStage {
  VOLUNTEER
  TEAM_COORDINATOR
  MINISTRY_LEADER
  SENIOR_LEADER
  PASTOR
}

enum MemberLifecycleStage {
  VISITOR
  FIRST_TIME_GUEST
  RETURNING_VISITOR
  REGULAR_ATTENDEE
  MEMBERSHIP_CANDIDATE
  NEW_MEMBER
  ESTABLISHED_MEMBER
  GROWING_MEMBER
  SERVING_MEMBER
  LEADING_MEMBER
  MATURE_LEADER
  INACTIVE_MEMBER
  DISCONNECTED_MEMBER
}

enum RetentionRisk {
  VERY_LOW
  LOW
  MEDIUM
  HIGH
  VERY_HIGH
}

enum UserRole {
  SUPER_ADMIN
  ADMIN_IGLESIA
  PASTOR
  LIDER
  MIEMBRO
}

enum VisitorCategory {
  FIRST_TIME
  RETURNING
  REGULAR
  NON_MEMBER
  MEMBER_CANDIDATE
}

// Platform-wide form models for marketing and lead generation
model PlatformForm {
  id           String    @id @default(cuid())
  name         String
  description  String?
  slug         String    @unique // URL-friendly identifier for public forms
  fields       Json      // Array of form field definitions
  style        Json      // Form styling configuration
  settings     Json      // Form settings (notifications, redirects, etc.)
  isActive     Boolean   @default(true)
  isPublic     Boolean   @default(true)  // Public forms accessible without auth
  campaignTag  String?   // Marketing campaign identifier
  leadScore    Int       @default(50)    // Base lead score for submissions
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  deletedAt    DateTime? // Soft delete support
  createdById  String    // SUPER_ADMIN who created the form
  
  // Relationships
  createdBy    users     @relation("PlatformFormCreatedBy", fields: [createdById], references: [id])
  submissions  PlatformFormSubmission[]
  qrCodes      PlatformQRCode[]
  
  @@index([slug])
  @@index([campaignTag])
  @@index([isActive, isPublic])
  @@index([createdAt])
}

model PlatformFormSubmission {
  id            String    @id @default(cuid())
  formId        String
  data          Json      // Submitted form data
  leadScore     Int       @default(0)     // Calculated lead score
  source        String    @default("direct") // Traffic source
  referrer      String?   // HTTP referrer
  userAgent     String?   // User agent string
  ipAddress     String?   // Client IP address
  campaignTag   String?   // Campaign tracking
  status        String    @default("new") // new, contacted, converted, processed, rejected
  notes         String?   // Admin notes
  followUpDate  DateTime? // Scheduled follow-up date
  processedAt   DateTime? // When lead was processed
  processedById String?   // SUPER_ADMIN who processed the lead
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relationships
  form          PlatformForm @relation(fields: [formId], references: [id], onDelete: Cascade)
  processedBy   users?       @relation("PlatformSubmissionProcessedBy", fields: [processedById], references: [id])
  
  @@index([formId])
  @@index([status])
  @@index([campaignTag])
  @@index([leadScore])
  @@index([createdAt])
  @@index([followUpDate])
}

// Platform QR code models for marketing campaigns
model PlatformQRCode {
  id               String    @id @default(cuid())
  formId           String
  config           Json      // QR code visual configuration (size, colors, logo, etc.)
  trackingParams   Json      // UTM and custom tracking parameters
  placementContext String?   // Where QR code is placed (business_card, flyer, poster, etc.)
  qrUrl            String    // The URL the QR code points to (with tracking params)
  isActive         Boolean   @default(true)
  scanCount        Int       @default(0)     // Total scan count
  lastScannedAt    DateTime? // Last time QR was scanned
  generatedById    String    // SUPER_ADMIN who generated the QR
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  // Relationships
  form             PlatformForm @relation(fields: [formId], references: [id], onDelete: Cascade)
  generatedBy      users        @relation("PlatformQRGeneratedBy", fields: [generatedById], references: [id])
  scans            PlatformQRScan[]
  
  @@index([formId])
  @@index([placementContext])
  @@index([scanCount])
  @@index([createdAt])
}

model PlatformQRScan {
  id             String    @id @default(cuid())
  qrCodeId       String
  scannedAt      DateTime  @default(now())
  userAgent      String?   // Device/browser info
  ipAddress      String?   // Scanner IP
  location       Json?     // Geographic data if available
  referrer       String?   // Page referrer
  conversionData Json?     // Conversion tracking data
  
  // Relationships
  qrCode         PlatformQRCode @relation(fields: [qrCodeId], references: [id], onDelete: Cascade)
  
  @@index([qrCodeId])
  @@index([scannedAt])
  @@index([ipAddress])
}

// Church QR Codes for tenant churches
model qr_codes {
  id          String    @id
  name        String
  type        String    // website, call, sms, email, whatsapp, form, payment, etc.
  data        String    // The actual data/URL for the QR code
  formId      String?   // Reference to custom form if type is "form"
  config      Json      // Visual configuration (colors, style, logo, etc.)
  preview     String?   @db.Text  // Base64 or URL to QR code preview image
  churchId    String
  createdBy   String
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relationships
  church      churches  @relation(fields: [churchId], references: [id], onDelete: Cascade)
  form        custom_forms? @relation(fields: [formId], references: [id], onDelete: SetNull)
  user        users     @relation("QRCodeCreatedBy", fields: [createdBy], references: [id])
  scans       qr_scans[]
  
  @@index([churchId])
  @@index([type])
  @@index([formId])
  @@index([createdAt])
}

model qr_scans {
  id         String    @id @default(cuid())
  qrCodeId   String
  scannedAt  DateTime  @default(now())
  userAgent  String?
  ipAddress  String?
  location   Json?
  
  // Relationships
  qrCode     qr_codes  @relation(fields: [qrCodeId], references: [id], onDelete: Cascade)
  
  @@index([qrCodeId])
  @@index([scannedAt])
}

